<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ุฅุนุฏุงุฏุงุช ุงูุจุงุญุซ - ุณููุงุช</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="center-header">
<header class="site-header"><div class="container"><div class="brand">ุณููุงุช</div></div></header>
<main class="container">
  <h1>ุฅุนุฏุงุฏุงุช ุงูุจุงุญุซ</h1>
  <form class="form-card" id="settingsForm">
    <div class="form-grid">
      <div class="field"><label for="firstName">ุงูุงุณู ุงูุฃูู</label><input id="firstName" /></div>
      <div class="field"><label for="lastName">ุงุณู ุงูุนุงุฆูุฉ</label><input id="lastName" /></div>

      <div class="field"><label for="email">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label><input id="email" type="email" /></div>
      <div class="field"><label for="phone">ุงูุฌูุงู</label><input id="phone" placeholder="05xxxxxxxx" /></div>

      <div class="field">
        <label for="password">ูููุฉ ุงููุฑูุฑ</label>
        <div style="display:flex; gap:8px; align-items:center">
          <input id="password" type="password" style="flex:1" />
          <button id="togglePwd" type="button" class="btn btn--secondary" title="ุฅุธูุงุฑ/ุฅุฎูุงุก">๐๏ธ</button>
        </div>
      </div>

      <div class="field"><label for="nationality">ุงูุฌูุณูุฉ</label><input id="nationality" /></div>
      <div class="field"><label for="nationalId">ุฑูู ุงููููุฉ/ุงูุฅูุงูุฉ</label><input id="nationalId" /></div>

      <div class="field" style="grid-column:1/-1">
        <label>ุงููุธุงุฆู (ุญุฏ ุฃูุตู: ุงุฎุชูุงุฑูู)</label>
        <div id="jobsGroup" class="jobs-group">
          <label class="check"><input type="checkbox" name="job" value="ูุงุดูุฑ" /> <span>ูุงุดูุฑ</span></label>
          <label class="check"><input type="checkbox" name="job" value="ูุญุงุณุจ" /> <span>ูุญุงุณุจ</span></label>
          <label class="check"><input type="checkbox" name="job" value="ุจุงุฆุน" /> <span>ุจุงุฆุน</span></label>
          <label class="check"><input type="checkbox" name="job" value="ุณูุฑุชูุฑ" /> <span>ุณูุฑุชูุฑ</span></label>
          <label class="check"><input type="checkbox" name="job" value="ุฎุฏูุฉ ุนููุงุก" /> <span>ุฎุฏูุฉ ุนููุงุก</span></label>
          <label class="check"><input type="checkbox" name="job" value="ุญุงุฑุณ ุฃูู" /> <span>ุญุงุฑุณ ุฃูู</span></label>
          <label class="check"><input type="checkbox" name="job" value="ูุงุฏู" /> <span>ูุงุฏู</span></label>
          <label class="check"><input type="checkbox" name="job" value="ุฃููููุง ุฃุณุจู" /> <span>ุฃููููุง ุฃุณุจู</span></label>
        </div>
        <div class="form-help">ุงููุฎุชุงุฑ: <span id="jobsCount">0</span>/2</div>
      </div>

      <div class="field">
        <label for="city">ุงููุฏููุฉ</label>
        <select id="city">
          <option>ุงูุฑูุงุถ</option>
          <option>ุฌุฏุฉ</option>
          <option>ููุฉ</option>
          <option>ุงููุฏููุฉ ุงููููุฑุฉ</option>
          <option>ุงูุฏูุงู</option>
          <option>ุงูุฎุจุฑ</option>
          <option>ุจุฑูุฏุฉ</option>
          <option>ุชุจูู</option>
          <option>ุฃุจูุง</option>
          <option>ุฌุงุฒุงู</option>
        </select>
      </div>

      <div class="field"><label for="age">ุงูุนูุฑ</label><input id="age" inputmode="numeric" maxlength="2" placeholder="ูุซุงู: 25" /></div>

      <div class="field" style="grid-column:1/-1"><label for="about">ูุจุฐุฉ</label><textarea id="about"></textarea></div>

      <div class="field" style="grid-column:1/-1">
  <label>ุงูุดูุงุฏุงุช ูุงูุฏูุฑุงุช</label>
  <input id="certsInput" type="file" multiple accept="application/pdf,.pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,.doc,.docx" />
        <div class="form-help">ูููู ุงูุฅุถุงูุฉ ุฃู ุงูุญุฐู โ ุงูุญุงูู: <span id="certsCount">0</span></div>
        <ul id="certList" class="file-list"></ul>
      </div>
    </div>
    <div class="actions" style="margin-top:12px">
      <button class="btn btn--primary" type="submit">ุญูุธ</button>
      <a class="btn" href="seeker-home.html">โฌ๏ธ ุฑุฌูุน</a>
      <button id="clearData" class="btn" type="button">๐๏ธ ูุณุญ ุจูุงูุงุชู</button>
    </div>
  </form>
</main>
<footer class="site-footer"><div class="container">ยฉ <span id="y"></span> ุณููุงุช</div></footer>
<script>
  document.getElementById('y').textContent = new Date().getFullYear();
  // Load strictly by currentSeekerId
  let p = {};
  try{
    const curId = localStorage.getItem('currentSeekerId')||'';
    const arr = JSON.parse(localStorage.getItem('seekers')||'[]');
    if (curId){ const f = arr.find(s=> s && s.id===curId); if (f) p = f; }
  }catch{}
  if (!p || !p.id){
    alert('ูุง ุชูุฌุฏ ุฌูุณุฉ ุจุงุญุซ ูุดุทุฉ. ุงูุฑุฌุงุก ุชุณุฌูู ุงูุฏุฎูู.');
    window.location.href = 'seeker-login.html';
  }
  const setVal = (id, v) => { const el = document.getElementById(id); if (el) el.value = v||''; };
  setVal('firstName', p.firstName);
  setVal('lastName', p.lastName);
  setVal('email', p.email);
  setVal('phone', p.phone);
  setVal('password', p.password);
  setVal('nationality', p.nationality);
  setVal('nationalId', p.nationalId);
  setVal('city', p.city);
  setVal('age', p.age);
  setVal('about', p.about);
  // Prefill jobs
  const jobsGroup = document.getElementById('jobsGroup');
  const jobsCount = document.getElementById('jobsCount');
  const preJobs = Array.isArray(p.jobs) ? new Set(p.jobs) : new Set();
  jobsGroup.querySelectorAll('input[name="job"]').forEach(cb => { if (preJobs.has(cb.value)) cb.checked = true; });
  const updateJobsCount = () => { jobsCount.textContent = String(jobsGroup.querySelectorAll('input[name="job"]:checked').length); };
  jobsGroup.addEventListener('change', (e)=>{
    if (e.target && e.target.name === 'job'){
      const checked = jobsGroup.querySelectorAll('input[name="job"]:checked');
      if (checked.length > 2){ e.target.checked = false; alert('ูููู ุงุฎุชูุงุฑ ูุธููุชูู ููุท'); }
      updateJobsCount();
    }
  });
  updateJobsCount();
  // Age input digits only
  document.getElementById('age').addEventListener('input', (ev)=>{ ev.target.value = (ev.target.value||'').replace(/[^0-9]/g,'').slice(0,2); });
  // Password eye toggle
  document.getElementById('togglePwd').addEventListener('click', ()=>{
    const input = document.getElementById('password');
    input.type = input.type === 'password' ? 'text' : 'password';
  });
  // Certificates
  const certsInput = document.getElementById('certsInput');
  const certList = document.getElementById('certList');
  const certsCount = document.getElementById('certsCount');
  const certs = new Map();
  function isAllowedCertName(name){
    const n=(name||'').toLowerCase(); return n.endsWith('.pdf')||n.endsWith('.doc')||n.endsWith('.docx');
  }
  function renderCerts(){
    certList.innerHTML='';
    for(const [key, name] of certs){
      const li = document.createElement('li'); li.className='file-item';
      const span = document.createElement('span'); span.textContent = name;
      const btn = document.createElement('button'); btn.type='button'; btn.className='btn btn--secondary file-remove'; btn.textContent='ุญุฐู';
      btn.addEventListener('click', ()=>{ certs.delete(key); renderCerts(); });
      li.append(span, btn); certList.appendChild(li);
    }
    certsCount.textContent = String(certs.size);
  }
  // Prefill from p.certificates (names only)
  if (Array.isArray(p.certificates)){
    for(const c of p.certificates){
      if (c && typeof c==='object' && c.name){ const k = `${c.name}|${Math.random()}`; certs.set(k, c.name); }
      else if (typeof c==='string'){ const k = `${c}|${Math.random()}`; certs.set(k, c); }
    }
    renderCerts();
  }
  certsInput.addEventListener('change', ()=>{
    const files = Array.from(certsInput.files||[]);
    for(const f of files){
      const n=f.name||'';
      if (!isAllowedCertName(n)) continue;
      const k = `${n}|${f.size}|${f.lastModified}`; if(!certs.has(k)) certs.set(k, n);
    }
    certsInput.value = ''; renderCerts();
  });

  document.getElementById('settingsForm').addEventListener('submit', (e)=>{
    e.preventDefault();
    p.firstName = document.getElementById('firstName').value.trim();
    p.lastName = document.getElementById('lastName').value.trim();
    p.email = document.getElementById('email').value.trim();
    p.phone = document.getElementById('phone').value.trim();
    p.password = document.getElementById('password').value;
    p.nationality = document.getElementById('nationality').value.trim();
    p.nationalId = document.getElementById('nationalId').value.trim();
    p.city = document.getElementById('city').value;
    p.age = document.getElementById('age').value.trim();
    p.about = document.getElementById('about').value.trim();
    // Jobs
    p.jobs = Array.from(document.querySelectorAll('input[name="job"]:checked')).map(i=>i.value);
  // Certs (names only from settings to keep simple; new uploads handled at register time)
  p.certificates = Array.from(certs.values());
    p.fullName = `${p.firstName||''} ${p.lastName||''}`.trim();
    try {
      if (!p.phone && !p.email){ alert('ูุฑุฌู ุฅุฏุฎุงู ุฑูู ุงูุฌูุงู ุฃู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู'); return; }
      // Upsert into global seekers for company browsing and preserve id
      const key = p.email || p.phone || p.nationalId || p.fullName;
      let seekers = [];
      try { seekers = JSON.parse(localStorage.getItem('seekers')||'[]'); } catch {}
      // enforce uniqueness across other profiles
      const norm = (s)=> (s||'').trim().toLowerCase();
      const dupe = seekers.find(x=> x && x.id!==p.id && ((p.phone && norm(x.phone)===norm(p.phone)) || (p.email && norm(x.email)===norm(p.email)) || (p.nationalId && norm(x.nationalId)===norm(p.nationalId))));
      if (dupe){ alert('ูุฐุง ุงูุฑูู ุฃู ุงูุจุฑูุฏ ุฃู ุงููููุฉ ูุณุฌูู ูุณุจูุงู'); return; }
      const idx = seekers.findIndex(s => s && s.id === p.id);
      const makeId = (keyStr) => { let h=0; for(const ch of (keyStr||'')){ h=((h<<5)-h)+ch.charCodeAt(0); h|=0;} return 's'+Math.abs(h); };
      if (idx >= 0) { p.id = seekers[idx].id || makeId(key); seekers[idx] = p; }
      else { p.id = makeId(key); seekers.push(p); }
      localStorage.setItem('seekers', JSON.stringify(seekers));
      localStorage.setItem('seekerProfile', JSON.stringify(p));
      if (p.id) localStorage.setItem('currentSeekerId', p.id);
    } catch {}
    alert('ุชู ุงูุญูุธ');
    window.location.href = 'seeker-home.html';
  });
  document.getElementById('clearData').addEventListener('click', ()=>{
    if(confirm('ูู ุชุฑูุฏ ูุณุญ ุจูุงูุงุชู ุงููุฎุฒูุฉ ุนูู ูุฐุง ุงููุชุตูุญุ')){
      try{ localStorage.removeItem('seekerProfile'); }catch{}
      alert('ุชู ุงููุณุญ');
      window.location.href = 'seeker-home.html';
    }
  });
</script>
</body>
</html>