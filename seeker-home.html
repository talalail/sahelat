<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø§Ù„Ø¨Ø§Ø­Ø«) - Ø³Ù‡Ù„Ø§Øª</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Rotating seeker messages */
    #seekRot{display:inline-block; opacity:0; transform:translateY(6px); transition: opacity .35s ease, transform .35s ease; color:#334155}
    #seekRot.show{opacity:1; transform:translateY(0)}
  </style>
  <script src="js/storage.js"></script>
</head>
<body class="center-header">
<header class="site-header"><div class="container"><div class="brand">Ø³Ù‡Ù„Ø§Øª</div></div></header>
<main class="container">
  <section id="emptyNotice" class="callout" style="display:none">
    Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù„Ù Ù…Ø­ÙÙˆØ¸. Ù…Ù† ÙØ¶Ù„Ùƒ Ù‚Ù… Ø¨Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.
    <div class="actions" style="margin-top:10px">
      <a class="btn btn--primary" href="seeker-register.html">ØªØ³Ø¬ÙŠÙ„ Ø¨Ø§Ø­Ø« Ø¬Ø¯ÙŠØ¯</a>
      <a class="btn" href="seeker-login.html">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</a>
    </div>
  </section>

  <!-- Yellow details card with black text as requested -->
  <section id="profileCard" class="yellow-card" style="display:none">
  <h2 class="pg-heading" style="margin-top:6px">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
    <div class="profile-head" style="margin-bottom:16px">
      <img id="avatar" class="avatar-pin" src="jobseeker.jpg" onerror="this.src='jobseeker-fallback.svg'" alt="ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ø­Ø«" />
      <button id="editPhotoBtn" type="button" class="avatar-edit-btn" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©">âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©</button>
      <input id="photoInput" type="file" accept="image/*" style="display:none" />
      <div class="profile-head__info">
  <h1 id="name" style="margin:6px 0 10px; font-size:20px; color:#0b1222">â€”</h1>
      </div>
    </div>

  <div class="detail-grid" style="margin-top:18px">
      <div class="kv"><label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„</label><div id="kFirst" class="val">-</div></div>
      <div class="kv" style="display:none"><label>Ø§Ø³Ù… Ø§Ù„Ø£Ø¨</label><div id="kMiddle" class="val">-</div></div>
      <div class="kv"><label>Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø©</label><div id="kLast" class="val">-</div></div>

      <div class="kv"><label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label><div id="kEmail" class="val" style="color:#0b1222">-</div></div>
      <div class="kv"><label>Ø§Ù„Ø¬ÙˆØ§Ù„</label><div id="kPhone" class="val" style="color:#0b1222">-</div></div>
      <div class="kv"><label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label><div id="kPassword" class="val" style="color:#0b1222">-</div></div>

      <div class="kv"><label>Ø§Ù„Ø¬Ù†Ø³ÙŠØ©</label><div id="kNationality" class="val" style="color:#0b1222">-</div></div>
      <div class="kv"><label>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©/Ø§Ù„Ø¥Ù‚Ø§Ù…Ø©</label><div id="kId" class="val" style="color:#0b1222">-</div></div>
      <div class="kv"><label>Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</label><div id="kJobs" class="chips">-</div></div>

      <div class="kv"><label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><div id="kCity" class="val" style="color:#0b1222">-</div></div>
      <div class="kv"><label>Ø§Ù„Ø¹Ù…Ø±</label><div id="kAge" class="val" style="color:#0b1222">-</div></div>
      <div class="kv"><label>Ù†Ø¨Ø°Ø©</label><div id="kAbout" class="val" style="color:#0b1222">-</div></div>

      <div class="kv" style="grid-column:1/-1">
        <label>Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª</label>
        <div id="kCerts" class="certs-list"></div>
      </div>
    </div>

    <div class="nav" style="margin-top:14px">
      <a class="btn" href="seeker-settings.html">âš™ï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a>
      <button id="seekerLogout" class="btn btn--secondary" type="button">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>
  </section>

  <section class="companies-section">
    <h2 class="section-title">Ø§Ù„Ø´Ø±ÙƒØ§Øª / Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª</h2>
    <div id="companies" class="companies-grid"></div>
  </section>
</main>
<footer class="site-footer"><div class="container">Â© <span id="y"></span> Ø³Ù‡Ù„Ø§Øª Â· <a class="btn" href="sync.html" style="padding:6px 10px">Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a></div></footer>
<!-- Floating corner message (Sahlat-style) for seekers -->
<div id="seekCornerMsg" style="position:fixed; bottom:12px; left:12px; z-index:50; max-width:280px; background:#fff; color:#0f172a; border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 8px 20px rgba(0,0,0,0.12); padding:10px 12px; display:block">
  <div style="display:flex; gap:10px; align-items:flex-start">
    <div style="flex:1">
  <div style="font-weight:800; margin:0 0 4px; font-size:15px">Ø³Ù‡Ù„Ø§Øª</div>
  <div style="color:#334155; line-height:1.6; font-size:13px"><span id="seekRot" class="show">ğŸ”” ØªØ±Ù‚Ù‘Ø¨ Ø£ÙˆÙ„ ØªÙˆØ§ØµÙÙ„ Ù‚Ø±ÙŠØ¨! Ø´Ø±ÙƒØªÙƒ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù‚Ø¯ ØªÙƒÙˆÙ† Ø¹Ù„Ù‰ Ø¨ÙØ¹Ø¯ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·.</span></div>
      
    </div>
  </div>
  </div>
<script>
  document.getElementById('y').textContent = new Date().getFullYear();
  // Robust session restore: ensure IDs, fall back to seekerProfile if needed
  let p = null;
  (function restoreSession(){
    try{
      const makeId = (keyStr) => { let h=0; for(const ch of (keyStr||'')){ h=((h<<5)-h)+ch.charCodeAt(0); h|=0;} return 's'+Math.abs(h); };
      let seekers = [];
      try{ seekers = JSON.parse(SahlatStore.getItem('seekers')||'[]'); }catch{}
      if (!Array.isArray(seekers)) seekers = [];
      const curId = ((SahlatStore.getItem('currentSeekerId'))||'').trim();
      // 1) Try find by currentSeekerId
      if (curId){ p = seekers.find(s=> s && s.id===curId) || null; }
      // 2) If not found, ensure IDs for any legacy seekers and retry
      if (!p){
        let mutated=false;
        for (const s of seekers){ if (s && !s.id){ const key=s.email||s.phone||s.nationalId||s.fullName||Math.random().toString(36); s.id = makeId(key); mutated=true; } }
  if (mutated){ try{ SahlatStore.setItem('seekers', JSON.stringify(seekers)); }catch{} }
        if (curId){ p = seekers.find(s=> s && s.id===curId) || null; }
      }
      // 3) If still not found, try to seed from seekerProfile and set session
      if (!p){
  let sp=null; try{ sp = JSON.parse(SahlatStore.getItem('seekerProfile')||'null'); }catch{}
        if (sp && (sp.fullName || sp.email || sp.phone || sp.nationalId)){
          if (!sp.id){ const key=sp.email||sp.phone||sp.nationalId||sp.fullName; sp.id = makeId(key); }
          // upsert into seekers by id (or contact info)
          const norm = (s)=> (s||'').trim().toLowerCase();
          const phoneEmailKey = (o)=> `${norm(o.phone)}|${norm(o.email)}|${norm(o.nationalId)}`;
          const keySP = phoneEmailKey(sp);
          const idxById = seekers.findIndex(x=> x && x.id===sp.id);
          const idxByContact = seekers.findIndex(x=> x && phoneEmailKey(x)===keySP);
          if (idxById>=0) seekers[idxById] = sp;
          else if (idxByContact>=0) seekers[idxByContact] = sp;
          else seekers.push(sp);
          try{ SahlatStore.setItem('seekers', JSON.stringify(seekers)); }catch{}
          try{ SahlatStore.setItem('currentSeekerId', sp.id); }catch{}
          p = sp;
        }
      }
    }catch{}
    // 4) If still nothing, show empty notice and stop rendering
    if (!p || !p.fullName){
      document.getElementById('emptyNotice').style.display = '';
      return; // do not throw to avoid breaking other UI parts
    }
  })();
  if (p && p.fullName){
  document.getElementById('profileCard').style.display = '';
  // Header: just full name
  document.getElementById('name').textContent = p.fullName;
  if (p.photoUrl) document.getElementById('avatar').src = p.photoUrl;
    // Fields
    const set = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = (val && String(val).trim()) || '-'; };
    set('kFirst', p.firstName);
    set('kMiddle', p.middleName);
    set('kLast', p.lastName);
    set('kEmail', p.email);
    set('kPhone', p.phone);
    set('kPassword', p.password);
    set('kNationality', p.nationality);
    set('kId', p.nationalId);
    set('kCity', p.city);
    set('kAge', p.age || (p.dob ? '' : '-'));
    set('kAbout', p.about);
    // Jobs chips
    const jobsC = document.getElementById('kJobs');
    jobsC.innerHTML = '';
    if (Array.isArray(p.jobs) && p.jobs.length){
      for(const j of p.jobs){
        const s = document.createElement('span'); s.className = 'chip-gray'; s.textContent = j; jobsC.appendChild(s);
      }
    } else { jobsC.textContent = '-'; }
    // Certificates (support both strings and objects)
    const certsC = document.getElementById('kCerts');
    if (Array.isArray(p.certificates) && p.certificates.length){
      certsC.innerHTML = '';
      for(const c of p.certificates){
        const d = document.createElement('span'); d.className = 'file'; d.textContent = (typeof c==='string') ? c : (c && c.name) || 'Ù…Ù„Ù'; certsC.appendChild(d);
      }
    } else { certsC.innerHTML = '<span class="form-help">-</span>'; }
  }

  // Companies list
  const container = document.getElementById('companies');
  let companies = [];
  try{ companies = JSON.parse(SahlatStore.getItem('companies')||'[]'); }catch{}
  if (!Array.isArray(companies)) companies = [];
  // Seed from currentCompany if list is empty
  try{
    if (companies.length===0){
  const cur = JSON.parse(SahlatStore.getItem('currentCompany')||'null');
      if (cur && (cur.name || cur.logo)){
        companies = [cur];
  try{ SahlatStore.setItem('companies', JSON.stringify(companies)); }catch{}
      }
    }
  }catch{}
  if (companies.length===0) {
    container.innerHTML = '<div class="form-help">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø±ÙƒØ§Øª Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
  } else {
    for (const c of companies) {
      const card = document.createElement('div');
      card.className = 'company-card';
      const logoSrc = (c && c.logo) ? c.logo : 'company-fallback.svg';
      card.innerHTML = `
        <img class="company-logo" src="${logoSrc}" alt="${(c&&c.name)||''}" onerror="this.onerror=null;this.src='company-fallback.svg'">
        <div class="company-name">${(c&&c.name)||'â€”'}</div>
      `;
      container.appendChild(card);
    }
  }

  // Edit photo flow
  const editBtn = document.getElementById('editPhotoBtn');
  const fileInput = document.getElementById('photoInput');
  editBtn.addEventListener('click', ()=> fileInput.click());
  fileInput.addEventListener('change', async ()=>{
    const file = fileInput.files && fileInput.files[0];
    if (!file) return;
    const dataUrl = await new Promise((resolve)=>{ const fr = new FileReader(); fr.onload = ()=>resolve(fr.result||''); fr.readAsDataURL(file); });
  const prof = JSON.parse(SahlatStore.getItem('seekerProfile')||'{}');
    prof.photoUrl = dataUrl;
    try{ localStorage.setItem('seekerProfile', JSON.stringify(prof)); }catch{}
    document.getElementById('avatar').src = dataUrl;
    fileInput.value = '';
  });

  // Rotate messages every 6s (corner bubble always visible)
  (function(){
    var msgs = [
      'ğŸ”” ØªØ±Ù‚Ù‘Ø¨ Ø£ÙˆÙ„ ØªÙˆØ§ØµÙÙ„ Ù‚Ø±ÙŠØ¨! Ø´Ø±ÙƒØªÙƒ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù‚Ø¯ ØªÙƒÙˆÙ† Ø¹Ù„Ù‰ Ø¨ÙØ¹Ø¯ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·.',
      'ğŸ’¼ ÙÙŠ ÙƒÙ„ ÙŠÙˆÙ… Ø´Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø© ØªÙ†Ø¶Ù… Ø¥Ù„Ù‰ â€œØ³Ù‡Ø§Ù„Ø§Øªâ€ ÙˆØªØ¨Ø­Ø« Ø¹Ù† Ø£Ø´Ø®Ø§Øµ Ù…Ø«Ù„Ùƒ.',
      'ğŸŒŸ Ù‚Ø¯ ØªÙƒÙˆÙ† ÙØ±ØµØªÙƒ Ø§Ù„ØªØ§Ù„ÙŠØ© Ø£Ù‚Ø±Ø¨ Ù…Ù…Ø§ ØªØªØ®ÙŠÙ„â€¦ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…!',
      'ğŸš€ Ø§Ø¨Ø¯Ø£ ÙŠÙˆÙ…Ùƒ Ø¨Ø®Ø·ÙˆØ© Ø¬Ø¯ÙŠØ¯Ø©! Ø§Ù„Ø´Ø±ÙƒØ§Øª ØªØªØ§Ø¨Ø¹ Ø§Ù„Ø¨Ø§Ø­Ø«ÙŠÙ† Ø§Ù„Ù†Ø´ÙŠØ·ÙŠÙ† Ø£ÙˆÙ„Ø§Ù‹.',
      'ğŸ’¬ Ù†Ø¤Ù…Ù† Ø£Ù† ÙƒÙ„ Ø´Ø®Øµ Ù„Ù‡ Ù…ÙƒØ§Ù†Ù‡ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ â€” ÙˆØ¯ÙˆØ±Ù†Ø§ Ù†ÙˆØµÙ„Ùƒ Ù„Ù‡ Ø¨Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª.',
      'âœ‰ ØªØ±Ù‚Ù‘Ø¨ Ø¥Ø´Ø¹Ø§Ø±Ùƒ Ø§Ù„Ù‚Ø§Ø¯Ù…â€¦ ÙŠÙ…ÙƒÙ† ÙŠÙƒÙˆÙ† ÙÙŠÙ‡ Ø¹Ø±Ø¶ Ø¹Ù…Ù„ ÙŠÙ†Ø§Ø³Ø¨Ùƒ ØªÙ…Ø§Ù…Ù‹Ø§!',
      'ğŸ‘ ÙƒÙ„ ÙŠÙˆÙ… ÙŠØ²Ø¯Ø§Ø¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ ÙÙŠ â€œØ³Ù‡Ø§Ù„Ø§Øªâ€ â€” ÙØ±ØµØªÙƒ ØªÙƒØ¨Ø± Ù…Ø¹Ø§Ù†Ø§.',
      'ğŸ” Ù†Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø£ÙØ¶Ù„ØŒ ÙˆÙŠÙ…ÙƒÙ† Ø£Ù†Øª ØªÙƒÙˆÙ† Ø§Ù„Ù‚Ø§Ø¯Ù… ÙÙŠ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ±Ø´ÙŠØ­Ø§Øª.',
      'ğŸ’¡ Ø§Ø³ØªØ¹Ø¯ØŒ Ù„Ø£Ù† Ø£ÙˆÙ„ Ø§ØªØµØ§Ù„ Ù…Ù† Ø´Ø±ÙƒØ© Ù…Ù…ÙƒÙ† ÙŠÙƒÙˆÙ† Ø£Ù‚Ø±Ø¨ Ù…Ù…Ø§ ØªØªØµÙˆØ±'
    ];
    var rot = document.getElementById('seekRot');
    if(!rot) return;
    var i = 1; // first already shown
    function cycle(){
      rot.classList.remove('show');
      setTimeout(function(){
        rot.textContent = msgs[i % msgs.length];
        i++;
        rot.classList.add('show');
      }, 220);
    }
    setTimeout(function(){ rot.classList.add('show'); }, 60);
    setInterval(cycle, 6000);
  })();

  // Logout clears active session
  (function(){
    var out = document.getElementById('seekerLogout');
    if (!out) return;
    out.addEventListener('click', function(){
  try{ SahlatStore.removeItem('currentSeekerId'); }catch{}
  try{ SahlatStore.removeItem('seekerProfile'); }catch{}
      window.location.href = 'seeker-login.html';
    });
  })();
</script>
</body>
</html>